<!DOCTYPE html>
<html>
<body>
    <canvas id="canvas" width="600" height="600"></canvas>
    <script type="module">
        async function init() {
            // 1. Check if WebGPU is available
            if (!navigator.gpu) {
                alert("WebGPU not supported! Update your browser.");
                return;
            }

            // 2. Setup the "Adapter" (The physical GPU)
            const adapter = await navigator.gpu.requestAdapter();
            const device = await adapter.requestDevice();

            // 3. Setup the Canvas
            const canvas = document.getElementById("canvas");
            const context = canvas.getContext("webgpu");
            const format = navigator.gpu.getPreferredCanvasFormat();
            
            context.configure({
                device: device,
                format: format,
            });

            // 4. The Shader (WGSL Code - Looks like Rust/C)
            const shaderCode = `
                @vertex
                fn vs_main(@builtin(vertex_index) id : u32) -> @builtin(position) vec4f {
                    // Simple triangle coordinates
                    var pos = array<vec2f, 3>(
                        vec2f( 0.0,  0.5),  // Top
                        vec2f(-0.5, -0.5),  // Bottom Left
                        vec2f( 0.5, -0.5)   // Bottom Right
                    );
                    return vec4f(pos[id], 0.0, 1.0);
                }

                @fragment
                fn fs_main() -> @location(0) vec4f {
                    return vec4f(0.2, 0.6, 1.0, 1.0); // Nice Blue Color
                }
            `;

            // 5. Create the Pipeline (Compile the shader)
            const module = device.createShaderModule({ code: shaderCode });
            const pipeline = device.createRenderPipeline({
                layout: "auto",
                vertex: {
                    module: module,
                    entryPoint: "vs_main",
                },
                fragment: {
                    module: module,
                    entryPoint: "fs_main",
                    targets: [{ format: format }],
                },
                primitive: { topology: "triangle-list" },
            });

            // 6. The Render Loop
            const commandEncoder = device.createCommandEncoder();
            const textureView = context.getCurrentTexture().createView();

            const passEncoder = commandEncoder.beginRenderPass({
                colorAttachments: [{
                    view: textureView,
                    loadOp: "clear",
                    clearValue: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 }, // Black Background
                    storeOp: "store",
                }],
            });

            passEncoder.setPipeline(pipeline);
            passEncoder.draw(3); // Draw 3 vertices (1 Triangle)
            passEncoder.end();

            device.queue.submit([commandEncoder.finish()]);
        }

        init();
    </script>
</body>
</html>
